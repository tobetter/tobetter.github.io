<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  

  <link rel="shortcut icon" href="https://docs.linuxfactory.or.kr/assets/img/favicon.ico">

  <title>Custom Linux kernel - Linux Factory</title>

  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />
  <link rel="stylesheet" href="https://docs.linuxfactory.or.kr/assets/css/theme.css" />
  <link rel="stylesheet" href="https://docs.linuxfactory.or.kr/assets/css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github-gist.min.css" />
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="https://docs.linuxfactory.or.kr/pages/tobetter/tobetter.github.io" class="icon icon-home"> Linux Factory</a>
          <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="/search.html" method="get">
    <input type="text" name="q" id="search-query" placeholder="Search docs" title="Type search term here" />
  </form>
</div>

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
                <ul>
                    <li class="toctree-l1">
                        <a class="reference internal" href="https://docs.linuxfactory.or.kr/">LinuxFactory</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1">
                        <a class="reference internal" href="https://docs.linuxfactory.or.kr/feed.xml"></a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1">
                        <a class="reference internal" href="https://docs.linuxfactory.or.kr/sitemap.xml"></a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1">
                        <a class="reference internal" href="https://docs.linuxfactory.or.kr/robots.txt"></a>
                    </li>
                </ul>
    <p class="caption"><span class="caption-text">faq</span></p>
                <ul>
                    <li class="toctree-l1">
                        <a class="reference internal" href="https://docs.linuxfactory.or.kr/faq/README.html">FAQ</a>
                    </li>
                </ul>
    <p class="caption"><span class="caption-text">guides</span></p>
                <ul>
                    <li class="toctree-l1">
                        <a class="reference internal" href="https://docs.linuxfactory.or.kr/guides/README.html">Guides</a>
                    </li>
                </ul><ul>
  <li class="toctree-l1 current"><a href="#custom-linux-kernel">Custom Linux kernel</a>
    <ul>
      <li class="toctree-l2"><a href="#prerequisites">Prerequisites</a>
        <ul>
          <li class="toctree-l3"><a href="#package-requirements">Package requirements</a></li>
          <li class="toctree-l3"><a href="#download-the-source-code">Download the Source code</a></li>
        </ul>
      </li>
      <li class="toctree-l2"><a href="#compile-your-custom-kernel">Compile your custom kernel</a>
        <ul>
          <li class="toctree-l3"><a href="#compile">Compile</a></li>
          <li class="toctree-l3"><a href="#install">Install</a></li>
        </ul>
      </li>
      <li class="toctree-l2"><a href="#tips">Tips</a>
        <ul>
          <li class="toctree-l3"><a href="#back-up-bootbootscr">Back up /boot/boot.scr</a></li>
          <li class="toctree-l3"><a href="#multiple-kernel-versions">Multiple kernel versions</a></li>
          <li class="toctree-l3"><a href="#switching-the-kernel-version">Switching the kernel version</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

                <ul>
                    <li class="toctree-l1">
                        <a class="reference internal" href="https://docs.linuxfactory.or.kr/guides/gpu_bifrost.html">GPU Acceleration with ARM Mali Bifrost</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1">
                        <a class="reference internal" href="https://docs.linuxfactory.or.kr/guides/gpu_panfrost.html">GPU Acceleration with ARM Mali Panfrost</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1">
                        <a class="reference internal" href="https://docs.linuxfactory.or.kr/guides/kernel_log.html">Kernel message through UART debugging port</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1">
                        <a class="reference internal" href="https://docs.linuxfactory.or.kr/guides/kmsdrm.html">Kernel mode setting</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1">
                        <a class="reference internal" href="https://docs.linuxfactory.or.kr/guides/nas_omv5.html">NAS with OpenMediaVault</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1">
                        <a class="reference internal" href="https://docs.linuxfactory.or.kr/guides/overclock.html">CPU/GPU frequency and governor</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1">
                        <a class="reference internal" href="https://docs.linuxfactory.or.kr/guides/sensors.html">Sensors</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1">
                        <a class="reference internal" href="https://docs.linuxfactory.or.kr/guides/usb_wifi.html">Installing USB WiFi driver</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1">
                        <a class="reference internal" href="https://docs.linuxfactory.or.kr/guides/zfs.html">The Z File System (ZFS)</a>
                    </li>
                </ul>
    <p class="caption"><span class="caption-text">install</span></p>
                <ul>
                    <li class="toctree-l1">
                        <a class="reference internal" href="https://docs.linuxfactory.or.kr/install/netboot_installer.html">Netboot Installer</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1">
                        <a class="reference internal" href="https://docs.linuxfactory.or.kr/install/odroidc4/image.html">ODROID-C4/HC4</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1">
                        <a class="reference internal" href="https://docs.linuxfactory.or.kr/install/odroidhc4/image.html">ODROID-HC4</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1">
                        <a class="reference internal" href="https://docs.linuxfactory.or.kr/install/odroidn2/image.html">ODROID-N2 / ODROID-N2Plus</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1">
                        <a class="reference internal" href="https://docs.linuxfactory.or.kr/install/odroidn2l/image.html">ODROID-N2L</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1">
                        <a class="reference internal" href="https://docs.linuxfactory.or.kr/install/odroidxu4/image.html">ODROID-XU4/HC1/HC2</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1">
                        <a class="reference internal" href="https://docs.linuxfactory.or.kr/install/prebuilt_image.html">Prebuilt OS Image</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1">
                        <a class="reference internal" href="https://docs.linuxfactory.or.kr/install/">Debian/Ubuntu Installation</a>
                    </li>
                </ul>
    <p class="caption"><span class="caption-text">troubles</span></p>
                <ul>
                    <li class="toctree-l1">
                        <a class="reference internal" href="https://docs.linuxfactory.or.kr/troubles/README.html">Troubles</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1">
                        <a class="reference internal" href="https://docs.linuxfactory.or.kr/troubles/gnome_terminal_not_opening.html">‘Gnome Terminal’ does not open</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1">
                        <a class="reference internal" href="https://docs.linuxfactory.or.kr/troubles/network_wired_unmanaged.html">‘Authentication Required’ when open the network setting</a>
                    </li>
                </ul>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="https://docs.linuxfactory.or.kr/pages/tobetter/tobetter.github.io">Linux Factory</a>
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
        <li><a href="https://docs.linuxfactory.or.kr/pages/tobetter/tobetter.github.io">Docs</a>&raquo;</li>
        <li>Guides &raquo;</li>
        <li>Custom Linux kernel</li>
    <li class="wy-breadcrumbs-aside">
        <a href="/blob/master/guides/compile_kernel.md" class="icon icon-github" target="_blank"> Edit on GitHub</a>
    </li>
  </ul>

  <hr/>
</div>

          <div role="main">
            <div class="section">
              <h1 id="custom-linux-kernel">Custom Linux kernel</h1>

<p>This page introduce how you can build the Linux kernel by yourself.</p>

<p>Linux kernel source is provided through Github repository and updated whenever
new kernel package is released. In order to build the Linux kernel, you must
download its kernel source using ‘git’ command and switch to the decent branch
which you are willing to build.</p>

<h2 id="prerequisites">Prerequisites</h2>
<h3 id="package-requirements">Package requirements</h3>
<p>In order to build Linux kernel, you need to install developement packages
required.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>apt <span class="nb">install </span>git build-essential bc flex bison libssl-dev libncurses-dev
</code></pre></div></div>

<h3 id="download-the-source-code">Download the Source code</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>git clone <span class="nt">--depth</span> 1 https://github.com/tobetter/linux <span class="se">\</span>
<span class="nt">-b</span> <span class="sb">`</span><span class="nb">uname</span> <span class="nt">-r</span> | <span class="nb">awk</span> <span class="nt">-F</span><span class="s1">'.'</span> <span class="s1">'{print "odroid-" $1 "." $2 ".y"}'</span><span class="sb">`</span>
<span class="nv">$ </span><span class="nb">cd </span>linux
<span class="nv">$ </span>git branch
</code></pre></div></div>

<h2 id="compile-your-custom-kernel">Compile your custom kernel</h2>
<p>Unline the generic desktop, your Ubuntu/Debian uses a package <strong>flash-kernel</strong>
that helps to install the Linux kernel packages and the device tree file for a
target device. You have to tweak a couple of things once in order to let the
package <strong>flash-kernel</strong> install your custom kernel properly.</p>

<h3 id="compile">Compile</h3>
<blockquote>
  <p>:warning: Use these commands once before preceeding.</p>
  <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cp</span> /boot/config-<span class="si">$(</span><span class="nb">uname</span> <span class="nt">-r</span><span class="si">)</span> .config
<span class="nv">$ </span><span class="nb">sed</span> <span class="nt">-i</span> <span class="s2">"s/.*CONFIG_LOCALVERSION_AUTO.*/CONFIG_LOCALVERSION_AUTO=y/g"</span> .config
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"-odroid-arm64"</span> <span class="o">&gt;</span> .scmversion
</code></pre></div>  </div>
  <p>Then, start to compile the Linux kernel source.</p>
  <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>make oldconfig
<span class="nv">$ </span>make <span class="nt">-j8</span>
</code></pre></div>  </div>
</blockquote>

<h3 id="install">Install</h3>
<blockquote>
  <p>:warning: Use these commands once before preceeding.</p>
  <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo sed</span> <span class="nt">-i</span> <span class="s2">"s/^force=.*</span><span class="nv">$/</span><span class="s2">force=</span><span class="se">\"</span><span class="s2">yes</span><span class="se">\"</span><span class="s2">/g"</span> /usr/share/flash-kernel/functions
<span class="nv">$ </span><span class="nb">sudo ln</span> <span class="nt">-s</span> <span class="nv">$PWD</span>/arch/arm64/boot/dts /usr/lib/linux-image-<span class="si">$(</span><span class="nb">cat </span>include/config/kernel.release<span class="si">)</span>
</code></pre></div>  </div>
  <p>Then, you can install the Linux kernel image and its drivers. The boot script,
the device tree file and initramfs will be updated while installing by the
<strong>flash-kernel</strong>. Please note that your Linux kernel version must ends with
<strong>-odroid-arm64</strong>, so ensure the last log with <strong>make modules_install</strong>.</p>
  <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>make modules_install
<span class="nv">$ </span><span class="nb">sudo </span>make <span class="nb">install</span>
</code></pre></div>  </div>
</blockquote>

<p>For example,</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>make modules_install
...
DEPMOD  5.9.15-odroid-arm64
<span class="nv">$ </span><span class="nb">sudo </span>make <span class="nb">install
</span>sh ./arch/arm64/boot/install.sh 5.9.15-odroid-arm64 <span class="se">\</span>
<span class="nb">arch</span>/arm64/boot/Image System.map <span class="s2">"/boot"</span>
run-parts: executing /etc/kernel/postinst.d/apt-auto-removal 5.9.15-odroid-arm64 /boot/vmlinuz-5.9.15-odroid-arm64
run-parts: executing /etc/kernel/postinst.d/initramfs-tools 5.9.15-odroid-arm64 /boot/vmlinuz-5.9.15-odroid-arm64
update-initramfs: Generating /boot/initrd.img-5.9.15-odroid-arm64
Using DTB: amlogic/meson64_odroidn2_plus.dtb
Installing amlogic into /boot/dtbs/5.9.15-odroid-arm64/amlogic/
Installing amlogic into /boot/dtbs/5.9.15-odroid-arm64/amlogic/
flash-kernel: installing version 5.9.15-odroid-arm64
Generating boot script u-boot image... <span class="k">done</span><span class="nb">.</span>
Taking backup of boot.scr.
Installing new boot.scr.
run-parts: executing /etc/kernel/postinst.d/unattended-upgrades 5.9.15-odroid-arm64 /boot/vmlinuz-5.9.15-odroid-arm64
run-parts: executing /etc/kernel/postinst.d/update-notifier 5.9.15-odroid-arm64 /boot/vmlinuz-5.9.15-odroid-arm64
run-parts: executing /etc/kernel/postinst.d/zz-flash-kernel 5.9.15-odroid-arm64 /boot/vmlinuz-5.9.15-odroid-arm64
Using DTB: amlogic/meson64_odroidn2_plus.dtb
Installing amlogic into /boot/dtbs/5.9.15-odroid-arm64/amlogic/
Installing amlogic into /boot/dtbs/5.9.15-odroid-arm64/amlogic/
flash-kernel: installing version 5.9.15-odroid-arm64
Generating boot script u-boot image... <span class="k">done</span><span class="nb">.</span>
Taking backup of boot.scr.
Installing new boot.scr.
</code></pre></div></div>

<h2 id="tips">Tips</h2>
<h3 id="back-up-bootbootscr">Back up <strong>/boot/boot.scr</strong></h3>
<p>Installing your custom Linux kernel will update the boot script with the
version of your custom Linux kernel. It’s good idea to back up the boot
script <strong>/boot/boot.scr</strong> to other file name and revert it when your
custom Linux kernel boot is failed.</p>

<h3 id="multiple-kernel-versions">Multiple kernel versions</h3>
<p>Your custom kernel won’t overwrite the Linux kernel files installed with
packages. So after installing your custom Linux kernel image, there would be
multiple Linux kernel files in <strong>/boot</strong> directory and they can be listed with
the command <strong>linux-version list</strong>.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>linux-version list
5.9.0-odroid-arm64
5.9.15-odroid-arm64
</code></pre></div></div>

<h3 id="switching-the-kernel-version">Switching the kernel version</h3>
<p>Suppose that you are running your custom kernel, but you want to switch to
the Linux kernel version installed with a kernel which is presented as
<strong>5.9.0-odroid-arm64</strong>, you can simply switch with <strong>flash-kernel</strong> with
a specific kernel version.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>flash-kernel <span class="nt">--force</span> 5.9.0-odroid-arm64
</code></pre></div></div>



            </div>
          </div>
          <footer>

    <hr/>

    <div role="contentinfo">
      <p>
            <span class="commit">Revision <code>f635bb00</code>.</span>
      </p>
    </div>
    Built with
    <a href="https://pages.github.com" target="_blank">GitHub Pages</a>
    using a <a href="https://github.com/carlosperate/jekyll-theme-rtd" target="_blank">theme</a>
    based on <a href="https://sphinx-rtd-theme.readthedocs.io" target="_blank">Read the Docs</a>.
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span><a href="https://docs.linuxfactory.or.kr/guides/README.html" style="color: #fcfcfc;">&laquo; Previous</a></span>
        <span style="margin-left: 15px"><a href="https://docs.linuxfactory.or.kr/guides/gpu_bifrost.html" style="color: #fcfcfc">Next &raquo;</a></span>
    </span>
</div>


  <script>var base_url = '';</script>
  <script src="https://docs.linuxfactory.or.kr/assets/js/jquery-2.1.1.min.js" defer></script>
  <script src="https://docs.linuxfactory.or.kr/assets/js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script src="https://docs.linuxfactory.or.kr/assets/js/theme.js" defer></script>
  <script type="text/javascript" defer>
    hljs.initHighlightingOnLoad();
    window.addEventListener('load', function() {
      SphinxRtdTheme.Navigation.enable(false);
    });
  </script>
  <!-- Build Date: 2025-09-30 05:16 -->
</body>
</html>
